<script>
  // @ts-nocheck

  import Dropzone from "svelte-file-dropzone";
  import JSZip from "jszip";
  import { saveAs } from 'file-saver';
  import { fade } from 'svelte/transition';

/* || Data || ----------------------------------------*/

  let dataImgsFiles = [];
  let quality = 0.45
  let converted = false
  
/* || Functions || ----------------------------------------*/

  function handleFilesSelect(e) {
    const { acceptedFiles, fileRejections } = e.detail;
    acceptedFiles.forEach((element)=>{
      dataImgsFiles = [...dataImgsFiles,{...element, id:crypto.randomUUID(),src:URL.createObjectURL(element)}]
    })

  }
  
  function handleRemoveAll(e) {
    e.stopPropagation();
    dataImgsFiles = [];
    converted = false
  }

  function handleRemoveFile(e, index) {
    dataImgsFiles.splice(index, 1);
    dataImgsFiles = dataImgsFiles

    setTimeout(removeBedelay,5)
    setTimeout(addBedelay,10)
    setTimeout(addDownImgs,15)

  }

  function addLoadBedelay(){
    dataImgsFiles.forEach(element => {
      document.getElementById(element.id).classList.add("bedelayload")
    });
  }

  function removeBedelay(){
    dataImgsFiles.forEach(element => {
      document.getElementById(element.id).classList.remove("bedelay")
      document.getElementById(element.id).removeAttribute("href")
      document.getElementById(element.id).removeAttribute("download")
    });
  }

  function addBedelay(){
    dataImgsFiles.forEach(element => {
      if (element.webpImg) {
        document.getElementById(element.id).classList.remove("bedelayload")
        document.getElementById(element.id).classList.add("bedelay")
      }
    });
  }

  function addDownImgs(){
    dataImgsFiles.forEach(element => {
      if (element.webpImg) {
        let enlace = document.getElementById(element.id)
        enlace.download = `${element.path.split(".", 1)[0]}.webp`;
        enlace.href = element.webpImg;
      }
    })
  }

  function convertImgWebp(){
    console.log("convirtiendo!")
    removeBedelay()
    addLoadBedelay()
    //Creo el canvas
    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");
    for (let index = 0; index < dataImgsFiles.length; index++) {
      //Creo una imagen nueva
      let img = new Image();
      //Cargo la imagen al canvas
      img.src = dataImgsFiles[index].src;
      console.log(img.src)
      img.onload = () => {
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.drawImage(img, 0, 0);

        //Convierto el cavas en webp
        let webpImage = canvas.toDataURL("image/webp", quality);
        
        // --> Guardo la imagen convertida
        dataImgsFiles[index] = {...dataImgsFiles[index],webpImg: String(webpImage)}

        canvas.toBlob((bolbImage) => {
          dataImgsFiles[index] = {...dataImgsFiles[index],canvasImg: bolbImage}
        },"image/webp", quality);

        addBedelay()
        addDownImgs()

        converted = true
        console.log("convirtido!")

      };
    }
    // console.log("dataImgsFiles",dataImgsFiles)
    // console.log("files.accepted",files.accepted)
  }

  function downloadZip(){

    let zip = new JSZip();
    dataImgsFiles.forEach(element => {
      zip.file(element.path.split(".", 1)[0] + ".webp", element.canvasImg)
    });
    
    zip.generateAsync({type:"blob"})
    .then(function(content) {
      saveAs(content, "photos.zip");
    });

  }

</script>

<main class="main-index">

  <h1 class="main-index__name">EasyWebp</h1>

  <Dropzone containerClasses="upload-box" disableDefaultStyles="true" on:drop={handleFilesSelect} accept={["image/*"]}>

    <svg class="upload-box__svg" width="120" height="85" viewBox="0 0 120 85" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path fill="#292929" stroke="#fff" stroke-width="3.5" d="M56.4483 0.124142C44.5089 1.29674 33.8652 7.74604 27.2476 17.8304C26.3914 19.1203 25.6973 20.1991 25.6741 20.246C25.651 20.2929 24.818 20.5039 23.8231 20.7619C18.2698 22.0987 13.4802 24.7956 9.50034 28.8528C4.15535 34.2468 1.19363 41.1417 0.892828 48.9043C0.430058 60.7007 6.8857 71.6293 17.4831 76.9529C21.5555 78.9932 25.3039 79.8375 31.158 80.0251C36.3179 80.1893 37.2665 80.0017 38.7705 78.4538C41.2232 75.9914 40.6447 72.1687 37.5905 70.6209C36.4335 70.0346 36.2022 70.0111 32.662 70.0111C27.155 70.0111 24.6561 69.4952 21.2084 67.619C17.5757 65.6725 14.8453 62.8817 12.948 59.1763C9.08385 51.5544 10.4027 42.2908 16.2105 36.2168C19.6581 32.6052 23.2677 30.8697 29.1449 29.9551C31.505 29.5799 32.3149 28.9232 33.8652 26.0386C38.2152 17.9242 45.365 12.4833 54.2733 10.5368C55.731 10.2085 57.235 10.1147 60.0579 10.1147C64.2923 10.1147 66.3285 10.443 69.7761 11.6625C74.1956 13.2573 77.8052 15.6025 81.1371 19.0499C85.4409 23.5058 87.9167 28.3134 89.1893 34.5751C89.4669 35.9353 89.8372 37.2721 90.0223 37.5535C91.0404 39.1248 92.6601 39.9691 94.65 39.9925C101.314 40.0395 107.469 44.9878 108.973 51.484C109.435 53.4305 109.435 56.5731 108.973 58.5196C108.024 62.6237 104.993 66.4933 101.244 68.346C98.2596 69.8235 97.0101 70.0111 89.8834 70.0111H83.7517L82.5254 70.6209C79.4711 72.1687 78.8927 75.9914 81.3453 78.4773C82.9188 80.072 83.5666 80.1893 91.4337 80.0251C98.4447 79.8844 99.671 79.7202 103.234 78.4069C110.5 75.7568 116.47 69.0496 118.529 61.2166C119.061 59.1294 119.13 58.4493 119.13 55.0018C119.13 51.5778 119.061 50.8743 118.529 48.8574C116.146 39.8049 109.366 33.0038 100.481 30.729L98.3984 30.2131L97.5191 27.4926C93.0071 13.5621 81.0677 3.05564 66.9763 0.616633C63.7832 0.0537854 59.2944 -0.157282 56.4483 0.124142Z"/>
      <path fill="#292929" stroke="#fff" stroke-width="3.5" d="M57.8598 35.5366C56.5409 36.1933 41.2232 51.7888 40.7373 52.938C39.4415 56.1275 41.4777 59.6453 44.7634 59.8798C47.0541 60.0439 47.5169 59.7625 51.543 55.7522L55.1988 52.1172V66.7043C55.1988 80.5879 55.222 81.3384 55.6385 82.1592C57.5821 85.9819 62.7189 85.935 64.4774 82.0888C64.8707 81.1977 64.917 80.2596 64.917 66.634V52.1172L68.5729 55.7522C72.599 59.7625 73.0618 60.0439 75.3293 59.8798C77.7589 59.6922 79.4942 57.9333 79.6794 55.4708C79.8645 52.9614 79.9339 53.0552 71.1875 44.1435C65.9814 38.8433 62.8577 35.8415 62.2561 35.5366C61.0066 34.9268 59.0861 34.9268 57.8598 35.5366Z"/>
    </svg>
    <div class="upload-box__text">
      <p class="upload-box__title">Drag and Drop here</p>
      <p class="upload-box__subtitle">JPG, JPEG & PNG</p>
    </div>
    <div class="upload-box__or">
      <span class="line"></span>
      <p>or</p>
      <span class="line"></span>
    </div>
    <button class="upload-box__btn">Upload Files</button>
    <div class="upload-box__cont-remove">
      <p class="upload-box__count">{dataImgsFiles.length} files uploaded</p>
      {#if dataImgsFiles.length > 0}
        <button class="upload-box__removeAll" on:click={handleRemoveAll}>Remove All</button>
      {/if}
    </div>

  </Dropzone>
  
  <section class="imgs-box">

    
    {#if dataImgsFiles.length == 0}
      <div class="imgs-box__svg">
        <svg width="268" height="233" viewBox="0 0 268 233" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="118" y="112.75" width="90" height="50" rx="7" fill="#EDEDED"/>
          <path d="M187.298 141.219C191.999 141.219 195.811 137.416 195.811 132.724C195.811 128.033 191.999 124.23 187.298 124.23C182.596 124.23 178.784 128.033 178.784 132.724C178.784 137.416 182.596 141.219 187.298 141.219Z" fill="#B5B5B5" fill-opacity="0.82"/>
          <path d="M118 141.813V156.587C117.999 156.954 118.034 157.319 118.103 157.679C118.127 157.843 118.166 158.002 118.205 158.162C118.249 158.326 118.303 158.49 118.357 158.65C118.391 158.737 118.421 158.824 118.46 158.906C118.474 158.949 118.494 158.988 118.514 159.031C118.558 159.137 118.607 159.239 118.66 159.34C118.66 159.345 118.66 159.35 118.665 159.35C118.695 159.408 118.724 159.466 118.753 159.519C118.812 159.625 118.876 159.732 118.939 159.833C119.017 159.958 119.096 160.074 119.184 160.19C119.233 160.263 119.287 160.332 119.345 160.398C119.394 160.461 119.448 160.524 119.497 160.586C119.55 160.651 119.607 160.712 119.668 160.77C119.704 160.814 119.744 160.856 119.785 160.895C119.864 160.973 119.942 161.05 120.025 161.122C120.054 161.152 120.085 161.18 120.118 161.205C120.172 161.253 120.23 161.301 120.289 161.349C120.318 161.374 120.353 161.403 120.387 161.427C120.411 161.446 120.436 161.465 120.465 161.49H120.47C120.577 161.573 120.688 161.65 120.803 161.721L120.803 161.723L120.804 161.725L120.806 161.726L120.808 161.726C120.813 161.726 120.813 161.731 120.817 161.736C120.886 161.784 120.959 161.828 121.033 161.871C121.072 161.895 121.111 161.915 121.15 161.934C121.159 161.942 121.169 161.948 121.179 161.953C121.223 161.977 121.262 162.001 121.307 162.021C121.419 162.079 121.532 162.137 121.649 162.19C121.784 162.253 121.923 162.31 122.065 162.359C122.067 162.362 122.07 162.364 122.073 162.366C122.077 162.368 122.08 162.368 122.084 162.369C122.116 162.382 122.149 162.393 122.182 162.402C122.246 162.426 122.314 162.451 122.378 162.47C122.427 162.484 122.471 162.494 122.52 162.509C122.622 162.542 122.73 162.567 122.838 162.591C122.866 162.599 122.896 162.606 122.926 162.61C122.979 162.624 123.033 162.634 123.087 162.644C123.09 162.643 123.092 162.644 123.095 162.645C123.097 162.645 123.1 162.647 123.102 162.649C123.119 162.648 123.135 162.651 123.151 162.658C123.162 162.658 123.174 162.659 123.185 162.663C123.268 162.678 123.356 162.687 123.444 162.702C123.493 162.707 123.547 162.711 123.601 162.716C123.608 162.72 123.617 162.722 123.625 162.721C123.649 162.721 123.679 162.726 123.703 162.726C123.728 162.73 123.752 162.731 123.777 162.731C123.798 162.735 123.819 162.737 123.84 162.736H123.865C123.889 162.74 123.918 162.74 123.948 162.745C124.046 162.75 124.143 162.75 124.241 162.75H201.759C203.136 162.747 204.473 162.296 205.565 161.466C206.656 160.637 207.439 159.476 207.795 158.162C207.834 158.002 207.873 157.843 207.897 157.679C207.966 157.319 208.001 156.954 208 156.587V148.868C207.829 148.723 207.662 148.573 207.496 148.419C207.325 148.259 207.159 148.1 206.992 147.936C205.535 146.439 204.208 144.823 203.026 143.106C202.986 143.053 202.947 143.005 202.913 142.952C202.835 142.841 202.757 142.734 202.673 142.623C201.487 140.909 200.16 139.294 198.707 137.794C198.54 137.629 198.374 137.47 198.203 137.311C196.383 135.62 194.309 134.36 191.864 134.06C188.493 133.645 185.358 135.185 182.585 137.311C182.379 137.47 182.179 137.629 181.978 137.794C181.029 138.557 180.129 139.387 179.278 140.213C179.053 140.435 178.823 140.658 178.593 140.88C178.002 141.464 177.395 142.048 176.784 142.623C176.608 142.787 176.436 142.947 176.26 143.106C173.815 145.342 171.168 147.308 168.023 147.936C167.808 147.979 167.588 148.018 167.368 148.047C166.18 148.203 164.973 148.166 163.797 147.936C163.602 147.902 163.411 147.859 163.215 147.81C160.271 147.091 157.541 144.397 155.071 142.224C154.895 142.064 154.714 141.905 154.538 141.741C153.276 140.587 152.078 139.35 150.958 138.133C150.586 137.727 150.204 137.317 149.823 136.911C149.666 136.752 149.515 136.592 149.363 136.428C147.726 134.667 145.935 133.051 144.012 131.598C143.782 131.429 143.552 131.27 143.322 131.116C140.735 129.372 137.908 128.252 134.802 128.43C132.239 128.575 129.896 129.618 127.788 131.116C127.572 131.27 127.357 131.429 127.142 131.598C125.538 132.871 124.074 134.307 122.774 135.882C122.622 136.061 122.471 136.245 122.319 136.428C122.241 136.52 122.167 136.617 122.089 136.708L121.928 136.911C120.632 138.51 119.384 140.171 118.059 141.741L118 141.813Z" fill="#D0D0D0"/>
          <path d="M238 147.75C243.523 147.75 248 143.273 248 137.75C248 132.227 243.523 127.75 238 127.75C232.477 127.75 228 132.227 228 137.75C228 143.273 232.477 147.75 238 147.75Z" fill="#F2F2F2"/>
          <path d="M236.636 142.955C236.463 142.955 236.293 142.914 236.138 142.837C235.984 142.76 235.849 142.648 235.746 142.51L233.018 138.872C232.841 138.636 232.765 138.339 232.806 138.047C232.848 137.755 233.004 137.492 233.24 137.315C233.476 137.138 233.773 137.062 234.065 137.103C234.357 137.145 234.621 137.301 234.798 137.537L236.582 139.917L241.167 133.041C241.248 132.919 241.352 132.815 241.473 132.733C241.595 132.652 241.731 132.596 241.874 132.567C242.017 132.538 242.165 132.538 242.308 132.566C242.451 132.595 242.588 132.651 242.709 132.732C242.831 132.813 242.935 132.917 243.016 133.039C243.098 133.16 243.154 133.296 243.183 133.439C243.212 133.583 243.212 133.73 243.183 133.874C243.155 134.017 243.099 134.153 243.018 134.275L237.561 142.459C237.463 142.607 237.33 142.729 237.174 142.815C237.019 142.902 236.845 142.949 236.667 142.954L236.636 142.955Z" fill="white"/>
          <rect x="118" y="182.75" width="90" height="50" rx="7" fill="#EDEDED"/>
          <path d="M187.298 211.219C191.999 211.219 195.811 207.416 195.811 202.724C195.811 198.033 191.999 194.23 187.298 194.23C182.596 194.23 178.784 198.033 178.784 202.724C178.784 207.416 182.596 211.219 187.298 211.219Z" fill="#B5B5B5" fill-opacity="0.82"/>
          <path d="M118 211.813V226.587C117.999 226.954 118.034 227.319 118.103 227.679C118.127 227.843 118.166 228.002 118.205 228.162C118.249 228.326 118.303 228.49 118.357 228.65C118.391 228.737 118.421 228.823 118.46 228.906C118.474 228.949 118.494 228.988 118.514 229.031C118.558 229.137 118.607 229.239 118.66 229.34C118.66 229.345 118.66 229.35 118.665 229.35C118.695 229.408 118.724 229.466 118.753 229.519C118.812 229.625 118.876 229.731 118.939 229.833C119.017 229.958 119.096 230.074 119.184 230.19C119.233 230.263 119.287 230.332 119.345 230.398C119.394 230.461 119.448 230.524 119.497 230.586C119.55 230.651 119.607 230.712 119.668 230.77C119.704 230.814 119.744 230.856 119.785 230.895C119.864 230.973 119.942 231.05 120.025 231.122C120.054 231.152 120.085 231.18 120.118 231.205C120.172 231.253 120.23 231.301 120.289 231.349C120.318 231.374 120.353 231.403 120.387 231.427C120.411 231.446 120.436 231.465 120.465 231.489H120.47C120.577 231.573 120.688 231.65 120.803 231.721L120.803 231.723L120.804 231.725L120.806 231.726L120.808 231.726C120.813 231.726 120.813 231.731 120.817 231.736C120.886 231.784 120.959 231.828 121.033 231.871C121.072 231.895 121.111 231.914 121.15 231.934C121.159 231.942 121.169 231.948 121.179 231.953C121.223 231.977 121.262 232.001 121.307 232.021C121.419 232.079 121.532 232.137 121.649 232.19C121.784 232.253 121.923 232.31 122.065 232.359C122.067 232.362 122.07 232.364 122.073 232.366C122.077 232.367 122.08 232.368 122.084 232.368C122.116 232.382 122.149 232.393 122.182 232.402C122.246 232.426 122.314 232.451 122.378 232.47C122.427 232.484 122.471 232.494 122.52 232.509C122.622 232.542 122.73 232.566 122.838 232.591C122.866 232.599 122.896 232.606 122.926 232.61C122.979 232.624 123.033 232.634 123.087 232.644C123.09 232.643 123.092 232.644 123.095 232.645C123.097 232.645 123.1 232.647 123.102 232.649C123.119 232.648 123.135 232.651 123.151 232.658C123.162 232.657 123.174 232.659 123.185 232.663C123.268 232.678 123.356 232.687 123.444 232.702C123.493 232.707 123.547 232.711 123.601 232.716C123.608 232.72 123.617 232.722 123.625 232.721C123.649 232.721 123.679 232.726 123.703 232.726C123.728 232.73 123.752 232.731 123.777 232.731C123.798 232.735 123.819 232.736 123.84 232.735H123.865C123.889 232.74 123.918 232.74 123.948 232.745C124.046 232.75 124.143 232.75 124.241 232.75H201.759C203.136 232.747 204.473 232.296 205.565 231.466C206.656 230.637 207.439 229.475 207.795 228.162C207.834 228.002 207.873 227.843 207.897 227.679C207.966 227.319 208.001 226.954 208 226.587V218.868C207.829 218.723 207.662 218.573 207.496 218.419C207.325 218.259 207.159 218.1 206.992 217.936C205.535 216.439 204.208 214.823 203.026 213.106C202.986 213.053 202.947 213.005 202.913 212.952C202.835 212.841 202.757 212.734 202.673 212.623C201.487 210.909 200.16 209.294 198.707 207.793C198.54 207.629 198.374 207.47 198.203 207.311C196.383 205.62 194.309 204.36 191.864 204.06C188.493 203.645 185.358 205.185 182.585 207.311C182.379 207.47 182.179 207.629 181.978 207.793C181.029 208.557 180.129 209.387 179.278 210.213C179.053 210.435 178.823 210.657 178.593 210.88C178.002 211.464 177.395 212.048 176.784 212.623C176.608 212.787 176.436 212.947 176.26 213.106C173.815 215.342 171.168 217.308 168.023 217.936C167.808 217.979 167.588 218.018 167.368 218.047C166.18 218.203 164.973 218.166 163.797 217.936C163.602 217.902 163.411 217.859 163.215 217.81C160.271 217.091 157.541 214.397 155.071 212.224C154.895 212.064 154.714 211.905 154.538 211.741C153.276 210.587 152.078 209.35 150.958 208.133C150.586 207.727 150.204 207.317 149.823 206.911C149.666 206.752 149.515 206.592 149.363 206.428C147.726 204.667 145.935 203.05 144.012 201.598C143.782 201.429 143.552 201.27 143.322 201.115C140.735 199.372 137.908 198.251 134.802 198.43C132.239 198.575 129.896 199.618 127.788 201.115C127.572 201.27 127.357 201.429 127.142 201.598C125.538 202.871 124.074 204.307 122.774 205.882C122.622 206.061 122.471 206.245 122.319 206.428C122.241 206.52 122.167 206.617 122.089 206.708L121.928 206.911C120.632 208.51 119.384 210.171 118.059 211.741L118 211.813Z" fill="#D0D0D0"/>
          <path d="M238 217.75C243.523 217.75 248 213.273 248 207.75C248 202.227 243.523 197.75 238 197.75C232.477 197.75 228 202.227 228 207.75C228 213.273 232.477 217.75 238 217.75Z" fill="#F2F2F2"/>
          <path d="M236.636 212.955C236.463 212.955 236.293 212.914 236.138 212.837C235.984 212.76 235.849 212.648 235.746 212.51L233.018 208.872C232.841 208.636 232.765 208.339 232.806 208.047C232.848 207.755 233.004 207.492 233.24 207.315C233.476 207.138 233.773 207.062 234.065 207.103C234.357 207.145 234.621 207.301 234.798 207.537L236.582 209.917L241.167 203.041C241.248 202.919 241.352 202.815 241.473 202.733C241.595 202.652 241.731 202.596 241.874 202.567C242.017 202.538 242.165 202.538 242.308 202.566C242.451 202.595 242.588 202.651 242.709 202.732C242.831 202.813 242.935 202.917 243.016 203.039C243.098 203.16 243.154 203.296 243.183 203.44C243.212 203.583 243.212 203.73 243.183 203.874C243.155 204.017 243.099 204.153 243.018 204.275L237.561 212.459C237.463 212.607 237.33 212.729 237.174 212.816C237.019 212.902 236.845 212.949 236.667 212.954L236.636 212.955Z" fill="white"/>
          <rect x="65" y="0.25" width="155" height="90" rx="10" fill="#717171"/>
          <path d="M181.983 39.3968C189.18 39.3968 195.015 33.575 195.015 26.3933C195.015 19.2117 189.18 13.3899 181.983 13.3899C174.785 13.3899 168.95 19.2117 168.95 26.3933C168.95 33.575 174.785 39.3968 181.983 39.3968Z" fill="white"/>
          <path d="M220 53.893V79.5484C220.001 80.1844 219.942 80.819 219.823 81.4439C219.781 81.729 219.714 82.0058 219.646 82.2825C219.57 82.5677 219.478 82.8528 219.385 83.1296C219.326 83.2806 219.276 83.4315 219.208 83.5741C219.183 83.6496 219.149 83.7167 219.116 83.7922C219.04 83.9767 218.955 84.1528 218.863 84.3289C218.863 84.3373 218.863 84.3457 218.854 84.3457C218.804 84.4463 218.753 84.547 218.703 84.6393C218.602 84.8237 218.492 85.0083 218.383 85.1844C218.248 85.4024 218.113 85.6037 217.961 85.805C217.876 85.9307 217.783 86.0512 217.683 86.1657C217.599 86.2747 217.506 86.3837 217.422 86.4927C217.331 86.6049 217.232 86.7114 217.127 86.8114C217.065 86.8882 216.997 86.9611 216.925 87.0295C216.79 87.1637 216.656 87.2979 216.512 87.4237C216.463 87.4756 216.41 87.5232 216.352 87.5663C216.26 87.6501 216.159 87.734 216.058 87.8179C216.007 87.8598 215.948 87.9101 215.889 87.9521C215.847 87.9856 215.805 88.0191 215.754 88.0611H215.746C215.562 88.2056 215.371 88.3399 215.173 88.4637L215.173 88.4669L215.171 88.4697L215.168 88.4715L215.165 88.4721C215.156 88.4721 215.156 88.4804 215.148 88.4888C215.03 88.5727 214.904 88.6482 214.777 88.7237C214.71 88.7656 214.642 88.7991 214.575 88.8327C214.56 88.8467 214.543 88.858 214.524 88.8662C214.449 88.9082 214.381 88.9501 214.305 88.9836C214.112 89.0843 213.918 89.1849 213.716 89.2772C213.482 89.3872 213.243 89.4852 213 89.5707C212.996 89.5758 212.991 89.58 212.985 89.5829C212.979 89.5858 212.973 89.5874 212.966 89.5875C212.911 89.6108 212.855 89.6304 212.798 89.6462C212.688 89.6881 212.57 89.7301 212.461 89.7636C212.376 89.7888 212.301 89.8055 212.216 89.8307C212.039 89.8894 211.854 89.9313 211.669 89.9733C211.619 89.9884 211.568 89.9997 211.517 90.0068C211.424 90.032 211.332 90.0488 211.239 90.0655C211.235 90.0649 211.23 90.0654 211.226 90.0668C211.221 90.0683 211.217 90.0707 211.214 90.0739C211.185 90.072 211.156 90.0778 211.13 90.0907C211.11 90.0893 211.09 90.0922 211.071 90.0991C210.927 90.1242 210.776 90.141 210.624 90.1661C210.54 90.1745 210.447 90.1829 210.355 90.1913C210.342 90.1981 210.327 90.201 210.312 90.1997C210.27 90.1997 210.22 90.2081 210.178 90.2081C210.136 90.215 210.094 90.2178 210.051 90.2164C210.015 90.2237 209.979 90.2265 209.942 90.2248H209.9C209.858 90.2332 209.807 90.2332 209.757 90.2416C209.588 90.25 209.42 90.25 209.251 90.25H75.7489C73.3774 90.2448 71.0737 89.4614 69.1945 88.0211C67.3152 86.5807 65.9654 84.5638 65.3538 82.2825C65.2865 82.0057 65.219 81.7289 65.1769 81.4438C65.0581 80.8189 64.9988 80.1843 65 79.5483V64.6114C65.2948 64.3598 65.5813 64.0998 65.8677 63.8314C66.1625 63.5547 66.4489 63.2779 66.7353 62.9927C69.2446 60.3926 71.5299 57.5871 73.5671 54.6059C73.6345 54.5136 73.7019 54.4297 73.7609 54.3375C73.8957 54.1446 74.0304 53.9601 74.1737 53.7672C76.2167 50.7902 78.5016 47.9852 81.0054 45.3803C81.2919 45.0951 81.5783 44.8183 81.8731 44.5416C85.0068 41.6062 88.5785 39.4172 92.7905 38.8972C98.5946 38.176 103.994 40.8514 108.771 44.5416C109.124 44.8183 109.47 45.0951 109.815 45.3803C111.449 46.7054 112.999 48.148 114.465 49.5821C114.853 49.9679 115.249 50.3537 115.645 50.7395C116.664 51.7543 117.708 52.7691 118.761 53.7672C119.065 54.0523 119.36 54.3291 119.663 54.6059C123.875 58.489 128.432 61.9025 133.849 62.9927C134.219 63.0682 134.598 63.1353 134.977 63.1856C137.024 63.4569 139.102 63.3918 141.127 62.9927C141.464 62.934 141.792 62.8585 142.129 62.7747C147.201 61.525 151.901 58.38 156.155 54.6059C156.458 54.3291 156.77 54.0523 157.073 53.7672C159.247 51.7627 161.311 49.6157 163.24 47.5022C163.88 46.7977 164.537 46.0848 165.194 45.3803C165.464 45.1035 165.725 44.8267 165.986 44.5416C168.805 41.4827 171.889 38.6763 175.202 36.1547C175.598 35.8612 175.993 35.5844 176.389 35.3161C180.846 32.2884 185.715 30.3427 191.064 30.6529C195.478 30.9045 199.513 32.7161 203.144 35.3161C203.514 35.5844 203.885 35.8612 204.256 36.1547C207.019 38.3646 209.54 40.8581 211.778 43.5939C212.039 43.9042 212.301 44.2229 212.562 44.5416C212.696 44.701 212.823 44.8687 212.958 45.028L213.236 45.3803C215.468 48.1564 217.616 51.0414 219.899 53.7672L220 53.893Z" fill="#595959"/>
          <path d="M220 79.5484V43.3003C218.036 43.4624 216.102 43.8798 214.246 44.5416C213.817 44.6926 213.387 44.8519 212.958 45.028C212.68 45.137 212.393 45.2545 212.115 45.3803C208.878 46.8688 205.844 48.7597 203.085 51.0079C201.956 51.8885 200.861 52.8195 199.799 53.7672C199.488 54.0523 199.176 54.3291 198.873 54.6059C197.988 55.4194 197.129 56.2497 196.287 57.0716C194.29 59.0257 192.269 61.047 190.188 62.9927C189.886 63.2769 189.583 63.5527 189.281 63.8285L189.278 63.8314C185.622 67.161 181.764 70.2054 177.493 72.2183C176.844 72.5202 176.187 72.8054 175.513 73.057C173.748 73.7453 171.907 74.2239 170.029 74.4828C165.941 75.0114 161.784 74.5215 157.933 73.057C157.233 72.8054 156.543 72.5286 155.86 72.2183C152.628 70.7382 149.583 68.883 146.788 66.6913C145.608 65.7855 144.446 64.8295 143.317 63.8314C142.997 63.5546 142.685 63.2779 142.374 62.9927C142.289 62.9172 142.205 62.8501 142.129 62.7747C139.265 60.1748 136.57 57.3735 134.042 54.6059C133.983 54.5387 133.916 54.4716 133.857 54.4046C133.663 54.1949 133.47 53.9769 133.276 53.7672C130.681 50.9408 127.96 48.0641 125.088 45.3803C124.785 45.0951 124.49 44.81 124.178 44.5416C120.556 41.2288 116.689 38.2682 112.57 36.1547C111.997 35.8528 111.416 35.5676 110.826 35.316C106.898 33.476 102.576 32.6263 98.2408 32.8419C94.9358 33.0556 91.7022 33.8954 88.7134 35.316C88.1489 35.576 87.593 35.8528 87.0454 36.1547C83.0194 38.4007 79.349 41.2269 76.1533 44.5416C75.8753 44.8183 75.6058 45.1035 75.3362 45.3803C74.081 46.6886 72.8764 48.0389 71.7307 49.406C70.5345 50.8318 69.372 52.2911 68.218 53.7672C67.9989 54.0439 67.7799 54.3207 67.5609 54.6059C66.7045 55.6989 65.8508 56.7948 65 57.8935V79.5483C64.9988 80.1843 65.0581 80.8189 65.1769 81.4438C65.219 81.7283 65.2862 82.0045 65.3534 82.2807L65.3538 82.2825C65.9654 84.5638 67.3152 86.5807 69.1945 88.0211C71.0737 89.4614 73.3774 90.2448 75.7489 90.25H209.251C209.47 90.25 209.689 90.2416 209.9 90.2248H210.034C210.041 90.2239 210.047 90.221 210.051 90.2164C210.094 90.2178 210.136 90.215 210.178 90.2081C210.22 90.2081 210.27 90.1997 210.312 90.1997C210.327 90.201 210.342 90.1981 210.355 90.1913L210.359 90.1909C210.45 90.1826 210.541 90.1744 210.624 90.1661C210.776 90.141 210.927 90.1242 211.071 90.0991C211.09 90.0922 211.11 90.0893 211.13 90.0907C211.156 90.0778 211.185 90.072 211.214 90.0739C211.217 90.0707 211.221 90.0683 211.226 90.0668C211.23 90.0654 211.235 90.0649 211.239 90.0655C211.332 90.0488 211.424 90.032 211.517 90.0068C211.568 89.9996 211.619 89.9884 211.669 89.9733C211.854 89.9313 212.039 89.8894 212.216 89.8307C212.301 89.8055 212.376 89.7888 212.461 89.7636C212.57 89.7301 212.688 89.6881 212.798 89.6462C212.855 89.6304 212.911 89.6108 212.966 89.5875C212.973 89.5873 212.979 89.5858 212.985 89.5829C212.991 89.58 212.996 89.5758 213 89.5707C213.243 89.4852 213.482 89.3872 213.716 89.2772C213.918 89.1849 214.112 89.0843 214.305 88.9836C214.381 88.9501 214.449 88.9081 214.524 88.8662C214.543 88.858 214.56 88.8467 214.575 88.8327L214.576 88.8322C214.643 88.7988 214.71 88.7654 214.777 88.7237L214.778 88.7231C214.904 88.6478 215.03 88.5725 215.148 88.4888C215.156 88.4805 215.156 88.4721 215.165 88.4721L215.168 88.4715L215.171 88.4697L215.173 88.4669L215.173 88.4637C215.371 88.3399 215.562 88.2056 215.746 88.0611H215.754C215.805 88.0193 215.847 87.9859 215.889 87.9526L215.889 87.9521C215.94 87.916 215.99 87.8738 216.036 87.8361L216.058 87.8179C216.159 87.734 216.26 87.6501 216.352 87.5663C216.41 87.5232 216.463 87.4756 216.512 87.4237C216.656 87.2979 216.79 87.1637 216.925 87.0295C216.997 86.9611 217.065 86.8882 217.127 86.8114C217.232 86.7114 217.331 86.605 217.422 86.4927C217.506 86.3837 217.599 86.2747 217.683 86.1657C217.783 86.0512 217.876 85.9307 217.961 85.805C218.113 85.6037 218.248 85.4024 218.383 85.1844C218.492 85.0083 218.602 84.8237 218.703 84.6392C218.753 84.5476 218.803 84.4476 218.853 84.3476L218.854 84.3457C218.863 84.3457 218.863 84.3373 218.863 84.3289C218.955 84.1528 219.04 83.9767 219.116 83.7922C219.149 83.7167 219.183 83.6496 219.208 83.5741C219.276 83.4315 219.326 83.2806 219.385 83.1296C219.478 82.8528 219.57 82.5677 219.646 82.2825L219.646 82.2815C219.714 82.0051 219.781 81.7286 219.823 81.4439C219.942 80.819 220.001 80.1844 220 79.5484Z" fill="#444444"/>
          <path d="M254 59.25C261.732 59.25 268 52.982 268 45.25C268 37.518 261.732 31.25 254 31.25C246.268 31.25 240 37.518 240 45.25C240 52.982 246.268 59.25 254 59.25Z" fill="#5A5A5A"/>
          <path d="M252.09 52.5362C251.849 52.5362 251.61 52.4799 251.394 52.3718C251.178 52.2637 250.99 52.1066 250.845 51.9132L247.025 46.8205C246.902 46.6569 246.813 46.4707 246.762 46.2726C246.712 46.0745 246.7 45.8684 246.729 45.6659C246.758 45.4635 246.827 45.2687 246.931 45.0927C247.035 44.9168 247.173 44.763 247.337 44.6403C247.5 44.5176 247.686 44.4284 247.885 44.3776C248.083 44.3269 248.289 44.3157 248.491 44.3446C248.694 44.3735 248.889 44.442 249.064 44.5462C249.24 44.6504 249.394 44.7883 249.517 44.9519L252.016 48.2833L258.433 38.6568C258.547 38.4866 258.693 38.3404 258.863 38.2266C259.033 38.1128 259.223 38.0336 259.424 37.9935C259.624 37.9534 259.831 37.9532 260.031 37.9929C260.232 38.0326 260.423 38.1114 260.593 38.2248C260.763 38.3383 260.909 38.4841 261.023 38.654C261.137 38.8239 261.216 39.0146 261.256 39.2152C261.296 39.4157 261.297 39.6222 261.257 39.8228C261.217 40.0235 261.138 40.2143 261.025 40.3845L253.386 51.8427C253.248 52.0499 253.062 52.221 252.844 52.3416C252.626 52.4622 252.383 52.5287 252.134 52.5357L252.09 52.5362Z" fill="white"/>
          <path d="M39.5 44.75H28.5C24.0817 44.75 20.5 48.3317 20.5 52.75V92.3934M20.5 140.037V202.75C20.5 207.168 24.0817 210.75 28.5 210.75H90.5M20.5 140.037H90.5M20.5 140.037V92.3934M20.5 92.3934H2" stroke="#EDEDED" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
    {/if}

    {#if dataImgsFiles.length != 0}
      <div class="imgs-list">
        {#each dataImgsFiles as item, index}
          <div in:fade class="imgs-list__item">
            <a class="imgs-list__img" id={item.id}>
              <img class="imgs-list__preview-img" src={item.src} alt="" />
            </a>
            <div class="imgs-list__box">
              <p class="imgs-list__name">{item.path}</p>
              <button class="imgs-list__remove" on:click={(e) => handleRemoveFile(e, index)}>
                <svg width="12" height="12" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M0.989525 0.318016C1.18479 0.122754 1.50137 0.122754 1.69663 0.318016L7.35349 5.97487C7.54875 6.17013 7.54875 6.48672 7.35349 6.68198C7.15822 6.87724 6.84164 6.87724 6.64638 6.68198L0.989525 1.02512C0.794263 0.829861 0.794263 0.513279 0.989525 0.318016Z" fill="#1F1F1F"/>
                  <path d="M0.989525 0.318016C1.18479 0.122754 1.50137 0.122754 1.69663 0.318016L7.35349 5.97487C7.54875 6.17013 7.54875 6.48672 7.35349 6.68198C7.15822 6.87724 6.84164 6.87724 6.64638 6.68198L0.989525 1.02512C0.794263 0.829861 0.794263 0.513279 0.989525 0.318016Z" fill="#1F1F1F"/>
                  <path d="M0.989576 6.682C0.794314 6.48674 0.794314 6.17015 0.989576 5.97489L6.64643 0.318038C6.84169 0.122776 7.15827 0.122776 7.35354 0.318038C7.5488 0.5133 7.5488 0.829883 7.35354 1.02514L1.69668 6.682C1.50142 6.87726 1.18484 6.87726 0.989576 6.682Z" fill="#1F1F1F"/>
                  <path d="M0.989576 6.682C0.794314 6.48674 0.794314 6.17015 0.989576 5.97489L6.64643 0.318038C6.84169 0.122776 7.15827 0.122776 7.35354 0.318038C7.5488 0.5133 7.5488 0.829883 7.35354 1.02514L1.69668 6.682C1.50142 6.87726 1.18484 6.87726 0.989576 6.682Z" fill="#1F1F1F"/>
                </svg>
              </button>
            </div>
          </div>
        {/each}
      </div>
    {/if}

    <div class="imgs-box__nav">
      <div class="imgs-box__box">
        <div class="imgs-box__quality">
          <p class="imgs-box__text">Low</p>
          <p class="imgs-box__text">Medium</p>
          <p class="imgs-box__text">High</p>
        </div>
        <input class="imgs-box__input" type="range" id="volume" min="0" max="0.9" bind:value="{quality}" step="0.05">
      </div>
      <div class="imgs-box__btns">
        <button class="imgs-box__down" disabled={!converted} on:click={downloadZip}>Download as Zip File</button>
        <button class="imgs-box__convert" disabled={dataImgsFiles.length == 0} on:click={convertImgWebp}>Convert</button>
      </div>
    </div>

  </section>

</main>

<style lang="scss">

  $cWhite: #ffffff;
  $cGrey1: #FAFAFA;
  $cGrey2: #F0F0F0;
  $cGrey3: #DBDBDB;
  $cGrey4: #C2C2C2;
  $cGrey5: #9E9E9E;
  $cGrey6: #7A7A7A;
  $cGrey7: #575757;
  $cGrey8: #3D3D3D;
  $cGrey9: #292929;
  $cGrey10: #1F1F1F;
  $cBlack: #000000;

  @import "src/assets/styles/style.scss";

  .main-index{
    @extend %container-center;
    display: grid;
    grid-template-areas:  "name"
                          "upload" 
                          "imgs";
    grid-template-columns: 1fr;
    justify-content: center;
    margin: auto;
    column-gap: 0rem;
    row-gap: 2rem;
  

    @include respond(md){
      grid-template-areas:  "name name"
                            "upload imgs";
      grid-template-columns: 350px 1fr;
      column-gap: 2rem;
      row-gap: 0rem;
    }


    .main-index__name{
      @include font(fbt1, w600);
      grid-area: name;
      margin: 24px 0 32px 0;
      justify-self: center;
    }

    //--------------------------------------------

    :global(.upload-box) {
      grid-area: upload;

      display: grid;
      grid-template-areas:  "iconUp"
                            "btnUp"
                            "contUp";
      grid-template-columns: 1fr;
      // display: flex;
      // flex-direction: column;
      justify-items: center;
      align-items: center;
      padding: 42px 0px;
      gap: 32px;
      border: none;
      background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='16' ry='16' stroke='%23333' stroke-width='5' stroke-dasharray='10%2c15' stroke-dashoffset='0' stroke-linecap='round'/%3e%3c/svg%3e");
      border-radius: 16px;

      @include respond(sm){
        grid-template-areas:  "iconUp orUp btnUp"
                              "textUp orUp contUp";
        grid-template-columns: 1fr 20px 1fr;
      }

      @include respond(md){
        grid-template-areas:  "iconUp"
                              "textUp"
                              "orUp"
                              "btnUp"
                              "contUp";
        grid-template-columns: 1fr;
      }

    }

      .upload-box__svg{
        grid-area: iconUp;
      }
      .upload-box__text{
        grid-area: textUp;
        display: none;
        align-items: center;
        gap: 1rem;

        @include respond(sm){
          @include flex(column);
        }

        .upload-box__title{
          @include font(ft2);
          color: $cGrey10;
        }
  
        .upload-box__subtitle{
          @include font(b1, w400);
          color: $cGrey7;
        }
      }
      .upload-box__or{
        grid-area: orUp;
        display: none;
        justify-content: space-between;
        align-items: center;
        width: fit-content;
        gap: 1rem;
        transform: none;

        @include respond(sm){
          transform: rotate(90deg);
        }
        @include respond(md){
          transform: none;
        }

        .line{
          height: 2px;
          width: 40px;
          background: $cGrey5;
        }

        p{
          @include font(fb1, w500);
          color: $cGrey6;

          @include respond(sm){
            transform: rotate(-90deg);
          }
          @include respond(md){
            transform: none;
          }
        }

        @include respond(sm){
          @include flex();
        }


      }
      .upload-box__btn{
        grid-area: btnUp;
        align-self: self-end;
        @include btn(cW,bgB);
      }
      .upload-box__cont-remove{
        grid-area: contUp;
        @include flex(column);
        align-items: center;
        gap: 1rem;
        height: 73px;

        .upload-box__count{
          @include font(fb1);
          color: $cGrey7;
        }
        .upload-box__removeAll{
          font-family: 'EuclidCircular';
          font-weight: 500;
          font-size: 16px;
          line-height: 20px;
          text-decoration-line: underline;
          text-underline-offset: 6px;
          text-decoration-thickness: 1.5px;
          padding: 0.5rem;
        }
      }

    //--------------------------------------------

    .imgs-box{
      grid-area: imgs;
      @include flex(column);
      height: 620px;

      background: #FFFFFF;
      border: 1px solid rgba(0, 0, 0, 0.16);
      border-radius: 16px;
      overflow: hidden;

      @include respond(md){
        height: 510px;
      }

      .imgs-box__svg{
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100%;
      }

      .imgs-list{
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(100%, .5fr));
        gap: 1.5rem;
        overflow: auto;
        padding-right: 0.5rem;
        height: 100%;
        padding: 1.5rem;

        @include respond(xs){
          grid-template-columns: repeat(auto-fit, minmax(150px, .5fr));
        }

        .imgs-list__item{
          position: relative;
          @include flex(column);
          box-shadow: 0px 0px 6px rgba(162, 162, 162, 0.25);
          height: max-content;
          border-radius: 6px;

            .imgs-list__img{
              display: inherit;
              position: relative;
              cursor: pointer;
              
            &::before{
              content: "";
              position: absolute;
              top: 0;
              left: 0;
              width: calc(100% - 6px);
              height: calc(100% - 6px);
              z-index: 999;
              border: 3px solid #FFFFFF;
              border-radius: 6px 6px 0 0 ;
  
              background: rgba(66, 66, 66, 0.15) url(/src/assets/imgs/tick.svg) no-repeat;
              background-position: center;
              background-size: 80px 80px;

              transition : all .4s linear;
              opacity: 0;
            }
            
            .imgs-list__preview-img{
              width: 100%;
              height: 200px;
              object-fit: cover;
              border: 3px solid #FFFFFF;
              border-radius: 6px 6px 0 0 ;
            }

          }


          .imgs-list__box{
            @include flex();
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            gap: 6px;
            border-radius: 0 0 6px 6px;

            .imgs-list__name{
              @include font(fb2, w500);
              text-overflow: ellipsis;
              overflow: hidden; 
              width: 100%;
              white-space: nowrap;
            }

            .imgs-list__remove{
              height: 12px;
            }
          }
        }
      }

      .imgs-box__nav{
        @include flex(column);
        justify-content: space-between;
        align-items: center;
        border-top: 1px solid rgba(0, 0, 0, 0.16);
        background: #FDFDFD;
        width: 100%;
        min-height: min-content;
        padding: 1rem 1.5rem;
        gap: 2rem;

        @include respond(xs){
          @include flex();
          min-height: 80px;
          padding: 0 1.5rem;

        }

        .imgs-box__box{
          @include flex(column);
          gap: 6px;
          width: 170px;

          .imgs-box__quality{
            @include flex();
            justify-content: space-between;
            align-items: center;
            .imgs-box__text{
              @include font(fc, w500);
              color: $cGrey6;
            }
          }

          $range-size: 1.5rem;
          $range-colour: #DF2046;  
          .imgs-box__input{
            
            -ms-appearance: none;
            -moz-appearance: none;
            -webkit-appearance: none;
            appearance: none;
            outline: none;
            cursor: pointer;
            /*extra*/
            display: block;
            position: relative;
            margin: .5rem 0;
            &::-webkit-slider-runnable-track {
              background: $cGrey4;
              border-radius: 3px;
              height: 5px;
              -webkit-appearance: none;
            }
            &::-webkit-slider-thumb {
              border: none;
              box-shadow: none;
              height: 12px;
              width: 12px;
              border-radius: 3px;
              transform: rotate(45deg);
              background: $cGrey9;
              -webkit-appearance: none;
              outline: none;
              margin: -.195rem 0 0 ;
            }
          }

        }

        .imgs-box__btns{
          @include flex(row,wrap);
          align-items: center;
          justify-content: center;
          gap: 24px;

          .imgs-box__down{
            font-family: 'EuclidCircular';
            font-weight: 500;
            font-size: 18px;
            line-height: 20px;
            padding: 0.5rem;
            &:hover{
              text-decoration-line: underline;
              text-underline-offset: 6px;
              text-decoration-thickness: 1.5px;
            }
          }
  
          .imgs-box__convert{
            @include btn(cW,bgB);
            font-size: 18px;
            height: 42px;
          }
        }


      }

    }

  }

</style>
